@startuml
actor User
participant "CLI (momentum_cli.py)" as CLI
participant "CLI Utils (cli_utils.py)" as Utils
participant "Habit Mgmt (cli_habit_management.py)" as HabitMgmt
participant "Database (momentum_db.py)" as DB
participant "Habit Class (habit.py)" as Habit
participant "Analysis (habit_analysis.py)" as Analysis

== Create New Habit ==
User -> CLI: Run momentum_cli.py
CLI -> CLI: Display main menu
User -> CLI: Select "Create new habit"
CLI -> HabitMgmt: create_new_habit()
HabitMgmt -> Utils: _handle_time_format()
Utils --> HabitMgmt: Validated time
HabitMgmt -> Habit: Habit(name, frequency, ...)
Habit --> HabitMgmt: Habit instance
HabitMgmt -> DB: add_habit(habit)
DB -> DB: Insert into habits table
DB --> HabitMgmt: habit_id
HabitMgmt -> CLI: Success message
CLI --> User: Habit created

== Mark Habit Complete ==
User -> CLI: Select "Mark habit completed"
CLI -> HabitMgmt: mark_habit_completed()
HabitMgmt -> Utils: _handle_habit_selection()
Utils --> HabitMgmt: Selected habit
HabitMgmt -> DB: add_completion(habit_id, datetime)
DB -> DB: Insert completion & update streak
DB --> HabitMgmt: Success
HabitMgmt -> CLI: Completion recorded
CLI --> User: Updated streak

== Analyze Habits ==
User -> CLI: Select "Analyze habits"
CLI -> Analysis: analyze_habits()
Analysis -> DB: get_all_habits()
DB --> Analysis: Habit list
Analysis -> Analysis: calculate_longest_streak_for_habit()
Analysis --> CLI: Analysis results
CLI --> User: Display analysis

== Export Data ==
User -> CLI: Select "Export to CSV"
CLI -> Export: analyze_export_csv()
Export -> DB: export_completions_to_csv()
DB -> DB: Query completions
DB --> Export: CSV file
Export --> CLI: Export complete
CLI --> User: CSV exported
@enduml
